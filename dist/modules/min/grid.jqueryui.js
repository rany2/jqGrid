!function(t,i){"use strict";"function"==typeof define&&define.amd?define(["jquery","./grid.base","free-jqgrid-plugins/ui.multiselect","jquery-ui/dialog","jquery-ui/draggable","jquery-ui/droppable","jquery-ui/resizable","jquery-ui/sortable"],function(e){return i(e,t,t.document)}):"object"==typeof module&&module.exports?module.exports=function(e,t){return e||(e=window),void 0===t&&(t="undefined"!=typeof window?require("jquery"):require("jquery")(e)),require("./grid.base"),require("free-jqgrid-plugins/ui.multiselect"),require("jquery-ui/dialog"),require("jquery-ui/draggable"),require("jquery-ui/droppable"),require("jquery-ui/resizable"),require("jquery-ui/sortable"),i(t,e,e.document),t}:i(jQuery,t,t.document)}("undefined"!=typeof window?window:this,function(G,x,s){"use strict";var C=G.jgrid,F=C.jqID,z=null!=G.ui?G.ui.multiselect:null,H=function(i){if(null!=this.grid&&null!=this.grid.p){var r,e,t,o,n,d=this,a=this.grid.p,l=this.gh,s=this.selectedList,u=this.inGroup,c=s.find("li"),p=c.length-1,h=function(e,t,i){var r,o,n=s.find("li");for(void 0===t&&(t=i?n.length-1:0),r=t;i?0<=r:r<n.length;i?r--:r++)if((o=G(n[r]).data("optionLink"))&&e.call(n[r],parseInt(o.val(),10),r))return r},g=function(){0<=(e=G.inArray(a.colModel[i].name,d.newColOrder))&&d.newColOrder.splice(e,1),c=s.find("li"),r=0,h(function(e,t){if(e===i){for(p=t;0<=r&&r<a.colModel.length&&r!==i&&(a.colModel[r].hidden||a.colModel[r].hidedlg)&&(null==u||u[r]===u[i]);)r++;return d.newColOrder.splice(r,0,a.colModel[i].name),!0}(r=G.inArray(a.colModel[e].name,d.newColOrder,r))<0&&(r=G.inArray(a.colModel[e].name,d.newColOrder)),r++})},f=function(e){if(u[e]===u[i])return G(this).after(c[p]),g(),!0},m=function(e){if(u[e]===u[i])return G(this).before(c[p]),g(),!0},b=function(e){if(u[e]===u[i]&&void 0!==u[e])return l[u[e]].startColumnName=a.colModel[e].name,!0};if(g(),l&&void 0!==l[u[i]]){for(o=l[u[i]],e=0;e<o.numberOfColumns;e++)if(r=a.iColByName[o.startColumnName]+e,!a.colModel[r].hidden&&!a.colModel[r].hidedlg){h(f,p-1,!0),h(m,p+1),h(b);break}}else if(l){if(c=s.find("li"),(e=h(function(e){if(e===i)return!0}))+1>=c.length||e<0)return;if((n=G(c[e+1]).data("optionLink"))&&void 0!==(t=u[parseInt(n.val(),10)])&&(n=G(c[e-1]).data("optionLink"))&&u[parseInt(n.val(),10)]===t){var v=h(function(e){if(u[e]!==t)return!0},e+1);G(c[void 0===v||v>=c.length?c.length-1:v-1]).after(c[p]),g()}}}};if(C.msie&&8===C.msiever()&&(G.expr[":"].hidden=function(e){return 0===e.offsetWidth||0===e.offsetHeight||"none"===e.style.display}),C._multiselect=!1,z){if(z.prototype._setSelected){var n=z.prototype._setSelected;z.prototype._setSelected=function(e,t){var i=n.call(this,e,t),r=this.element,o=parseInt(e.data("optionLink").val(),10);return t&&this.selectedList&&(H.call(this,o),this.selectedList.find("li").each(function(){G(this).data("optionLink")&&G(this).data("optionLink").remove().appendTo(r)})),i}}z.prototype.destroy&&(z.prototype.destroy=function(){var e=this;e.element.show(),e.container.remove(),void 0===G.Widget?G.widget.prototype.destroy.apply(e,arguments):G.Widget.prototype.destroy.apply(e,arguments)}),C._multiselect=!0}C.extend({sortableColumns:function(l){return this.each(function(){var n=this,d=n.p,e=F(d.id);if(d&&d.sortable&&G.jgrid.isFunction(G.fn.sortable)){var t={tolerance:"pointer",axis:"x",scrollSensitivity:"1",items:">th:not(:has(#jqgh_"+e+"_cb,#jqgh_"+e+"_rn,#jqgh_"+e+"_subgrid),:hidden)",placeholder:{element:function(e){return G(s.createElement(e[0].nodeName)).addClass(e[0].className+" ui-sortable-placeholder ui-state-highlight").removeClass("ui-sortable-helper")[0]},update:function(e,t){t.height(e.currentItem.innerHeight()-parseInt(e.currentItem.css("paddingTop")||0,10)-parseInt(e.currentItem.css("paddingBottom")||0,10)),t.width(e.currentItem.innerWidth()-parseInt(e.currentItem.css("paddingLeft")||0,10)-parseInt(e.currentItem.css("paddingRight")||0,10))}},start:function(){n.grid.hDiv.scrollLeft=n.grid.bDiv.scrollLeft},update:function(e,t){var i=G(">th",G(t.item).parent()),r=d.id+"_",o=[];i.each(function(){var e=G(">div",this).get(0).id.replace(/^jqgh_/,"").replace(r,""),t=d.iColByName[e];void 0!==t&&o.push(t)}),G(n).jqGrid("remapColumns",o,!0,!0),G.jgrid.isFunction(d.sortable.update)&&d.sortable.update(o),setTimeout(function(){d.disableClick=!1},50)}};if(d.sortable.options?G.extend(t,d.sortable.options):G.jgrid.isFunction(d.sortable)&&(d.sortable={update:d.sortable}),t.start){var i=t.start;t.start=function(e,t){a(),i.call(this,e,t)}}else t.start=a;d.sortable.exclude&&(t.items+=":not("+d.sortable.exclude+")");var r=l.sortable(t),o=r.data("sortable")||r.data("uiSortable")||r.data("ui-sortable");null!=o&&(o.floating=!0)}function a(){d.disableClick=!0}})},columnChooser:function(n){var t,d,e,i,r,a,o,l=this,s=l[0],u=s.p,c=u.colModel,p=c.length,h=u.colNames,g=function(e){return z&&z.prototype&&e.data(z.prototype.widgetFullName||z.prototype.widgetName)||e.data("ui-multiselect")||e.data("multiselect")};if(!G("#colchooser_"+F(u.id)).length){if(t=G('<div id="colchooser_'+u.id+'" style="position:relative;overflow:hidden"><div><select multiple="multiple"></select></div></div>'),d=G("select",t),n=G.extend({width:400,height:240,classname:null,done:function(e){e&&l.jqGrid("remapColumns",e,!0)},msel:"multiselect",dlog:"dialog",dialog_opts:{minWidth:470,dialogClass:"ui-jqdialog"},dlog_opts:function(e){var t={};return t[e.bSubmit]=function(){e.apply_perm(),e.cleanup(!1)},t[e.bCancel]=function(){e.cleanup(!0)},G.extend(!0,{buttons:t,close:function(){e.cleanup(!0)},modal:e.modal||!1,resizable:e.resizable||!0,width:e.width+70,resize:function(){var e=g(d),t=e.container.closest(".ui-dialog-content");0<t.length&&"object"==typeof t[0].style?t[0].style.width="":t.css("width",""),e.selectedList.height(Math.max(e.selectedContainer.height()-e.selectedActions.outerHeight()-1,1)),e.availableList.height(Math.max(e.availableContainer.height()-e.availableActions.outerHeight()-1,1))}},e.dialog_opts||{})},apply_perm:function(){var e,t,i=new Array(u.colModel.length),r={notSkipFrozen:void 0!==n.notSkipFrozen&&n.notSkipFrozen,skipSetGridWidth:!0,skipSetGroupHeaders:!0};for(e=0;e<u.colModel.length;e++)i[e]=u.iColByName[a.newColOrder[e]];if(G("option",d).each(function(){G(this).is(":selected")?l.jqGrid("showCol",c[this.value].name,r):l.jqGrid("hideCol",c[this.value].name,r)}),n.done&&n.done.call(l,i),u.groupHeader&&("object"==typeof u.groupHeader||G.jgrid.isFunction(u.groupHeader)))if(l.jqGrid("destroyGroupHeader",!1),u.groupHeader.groupHeaders=a.gh,null!=u.pivotOptions&&null!=u.pivotOptions.colHeaders&&1<u.pivotOptions.colHeaders.length)for(t=u.pivotOptions.colHeaders,e=0;e<t.length;e++)t[e]&&t[e].groupHeaders.length&&l.jqGrid("setGroupHeaders",t[e]);else l.jqGrid("setGroupHeaders",u.groupHeader);var o=u.autowidth||void 0!==u.widthOrg&&"auto"!==u.widthOrg&&"100%"!==u.widthOrg?u.width:u.tblwidth;o!==u.width&&l.jqGrid("setGridWidth",o,u.shrinkToFit)},cleanup:function(e){q(n.dlog,t,"destroy"),q(n.msel,d,"destroy"),t.remove(),e&&n.done&&n.done.call(l)},msel_opts:{}},l.jqGrid("getGridRes","col"),C.col,n||{}),G.ui&&z&&z.defaults){if(!C._multiselect)return void(null!=C.defaults&&G.jgrid.isFunction(C.defaults.fatalError)?C.defaults.fatalError:alert)("Multiselect plugin loaded after jqGrid. Please load the plugin before the jqGrid!");n.msel_opts=G.extend(z.defaults,n.msel_opts)}n.caption&&t.attr("title",n.caption),n.classname&&(t.addClass(n.classname),d.addClass(n.classname)),n.width&&(G(">div",t).css({width:n.width,margin:"0 auto"}),d.css("width",n.width)),n.height&&(G(">div",t).css("height",n.height),d.css("height",n.height-10)),d.empty();var f,m,b,v,j=null!=u.groupHeader?u.groupHeader.groupHeaders:0,y={};if(j)for(f=0;f<j.length;f++)for(v=j[f],m=0;m<v.numberOfColumns;m++)b=u.iColByName[v.startColumnName]+m,y[b]=G.jgrid.isFunction(n.buildItemText)?n.buildItemText.call(l[0],{iCol:b,cm:c[b],cmName:c[b].name,colName:h[b],groupTitleText:v.titleText}):G.jgrid.stripHtml(v.titleText)+": "+G.jgrid.stripHtml(""===h[b]?c[b].name:h[b]);for(b=0;b<p;b++)void 0===y[b]&&(y[b]=G.jgrid.isFunction(n.buildItemText)?n.buildItemText.call(l[0],{iCol:b,cm:c[b],cmName:c[b].name,colName:h[b],groupTitleText:null}):G.jgrid.stripHtml(h[b]));if(G.each(c,function(e){this.hidedlg||d.append("<option value='"+e+"'"+(u.headertitles||this.headerTitle?" title='"+C.stripHtml("string"==typeof this.headerTitle?this.headerTitle:y[e])+"'":"")+(this.hidden?"":" selected='selected'")+">"+y[e]+"</option>")}),e=G.isFunction(n.dlog_opts)?n.dlog_opts.call(l,n):n.dlog_opts,q(n.dlog,t,e),i=G.isFunction(n.msel_opts)?n.msel_opts.call(l,n):n.msel_opts,q(n.msel,d,i),(r=G("#colchooser_"+F(u.id))).css({margin:"auto"}),r.find(">div").css({width:"100%",height:"100%",margin:"auto"}),a=g(d)){var w,_;if(a.grid=s,j)for(a.gh=G.extend(!0,[],j),a.inGroup=new Array(u.colModel.length),w=0;w<j.length;w++)for(_=j[w],b=0;b<_.numberOfColumns;b++)a.inGroup[u.iColByName[_.startColumnName]+b]=w;a.newColOrder=G.map(c,function(e){return e.name}),a.container.css({width:"100%",height:"100%",margin:"auto"}),a.selectedContainer.css({width:100*a.options.dividerLocation+"%",height:"100%",margin:"auto",boxSizing:"border-box"}),a.availableContainer.css({width:100-100*a.options.dividerLocation+"%",height:"100%",margin:"auto",boxSizing:"border-box"}),a.selectedList.css("height","auto"),a.availableList.css("height","auto"),o=Math.max(a.selectedList.height(),a.availableList.height()),o=Math.min(o,G(x).height()),a.selectedList.css("height",o),a.availableList.css("height",o),null!=a.options&&a.options.sortable&&a.selectedList.on("sortupdate",function(e,t){H.call(a,parseInt(t.item.data("optionLink").val(),10)),t.item.css({width:"",height:""}),G.jgrid.isFunction(n.sortUpdate)&&n.sortUpdate.call(s,e,t)}),G.jgrid.isFunction(n.init)&&n.init.call(s,a)}}function q(e,t){e&&("string"==typeof e?G.fn[e]&&G.fn[e].apply(t,G.makeArray(arguments).slice(2)):G.jgrid.isFunction(e)&&e.apply(t,G.makeArray(arguments).slice(2)))}},sortableRows:function(d){return this.each(function(){var r=this,o=r.grid,n=r.p;o&&(n.treeGrid||G.fn.sortable&&((d=G.extend({cursor:"move",axis:"y",items:">tbody>.jqgrow"},d||{})).start&&G.jgrid.isFunction(d.start)?(d._start_=d.start,delete d.start):d._start_=!1,d.update&&G.jgrid.isFunction(d.update)?(d._update_=d.update,delete d.update):d._update_=!1,d.start=function(e,t){if(G(t.item).css("border-width","0"),G("td",t.item).each(function(e){this.style.width=o.cols[e].style.width}),n.subGrid){var i=G(t.item).attr("id");try{G(r).jqGrid("collapseSubGridRow",i)}catch(e){}}d._start_&&d._start_.apply(this,[e,t])},d.update=function(e,t){G(t.item).css("border-width",""),!0===n.rownumbers&&G("td.jqgrid-rownum",r.rows).each(function(e){G(this).html(e+1+(parseInt(n.page,10)-1)*parseInt(n.rowNum,10))}),d._update_&&d._update_.apply(this,[e,t])},G(r).sortable(d)))})},gridDnD:function(r){return this.each(function(){var e,t,f=this;if(f.grid&&!f.p.treeGrid&&G.fn.draggable&&G.fn.droppable){if(void 0===G("#jqgrid_dnd")[0]&&G("body").append("<table id='jqgrid_dnd' class='ui-jqgrid-dnd'></table>"),"string"!=typeof r||"updateDnD"!==r||!0!==f.p.jqgdnd){if((r=G.extend({drag:function(o){return G.extend({start:function(e,t){var i,r;if(f.p.subGrid){r=G(t.helper).attr("id");try{G(f).jqGrid("collapseSubGridRow",r)}catch(e){}}for(i=0;i<G.data(f,"dnd").connectWith.length;i++)0===G(G.data(f,"dnd").connectWith[i]).jqGrid("getGridParam","reccount")&&G(G.data(f,"dnd").connectWith[i]).jqGrid("addRowData","jqg_empty_row",{});t.helper.addClass("ui-state-highlight"),G("td",t.helper).each(function(e){this.style.width=f.grid.headers[e].width+"px"}),o.onstart&&G.jgrid.isFunction(o.onstart)&&o.onstart.call(G(f),e,t)},stop:function(e,t){var i,r;for(t.helper.dropped&&!o.dragcopy&&(void 0===(r=G(t.helper).attr("id"))&&(r=G(this).attr("id")),G(f).jqGrid("delRowData",r)),i=0;i<G.data(f,"dnd").connectWith.length;i++)G(G.data(f,"dnd").connectWith[i]).jqGrid("delRowData","jqg_empty_row");o.onstop&&G.jgrid.isFunction(o.onstop)&&o.onstop.call(G(f),e,t)}},o.drag_opts||{})},drop:function(g){return G.extend({accept:function(e){if(!G(e).hasClass("jqgrow"))return e;var t=G(e).closest("table.ui-jqgrid-btable");if(0<t.length&&void 0!==G.data(t[0],"dnd")){var i=G.data(t[0],"dnd").connectWith;return-1!==G.inArray("#"+F(this.id),i)}return!1},drop:function(e,t){if(G(t.draggable).hasClass("jqgrow")){var i,r=G(t.draggable).attr("id"),o=t.draggable.parent().parent(),n=o.jqGrid("getRowData",r);if(!g.dropbyname){var d,a,l,s,u={},c=o.jqGrid("getGridParam","colModel"),p=G("#"+F(this.id)).jqGrid("getGridParam","colModel");try{for(a=d=0;d<c.length&&a<p.length;d++)if("cb"!==(l=c[d].name)&&"rn"!==l&&"subgrid"!==l){for(;a<p.length;a++)if("cb"!==(s=p[a].name)&&"rn"!==s&&"subgrid"!==s){u[s]=n[l];break}a++}n=u}catch(e){}}if(t.helper.dropped=!0,g.beforedrop&&G.jgrid.isFunction(g.beforedrop)){var h=g.beforedrop.call(this,e,t,n,G("#"+F(f.p.id)),G(this));null!=h&&"object"==typeof h&&(n=h)}if(t.helper.dropped)g.autoid&&(i=G.jgrid.isFunction(g.autoid)?g.autoid.call(this,n,{rowid:r,ev:e,ui:t}):(i=Math.ceil(1e3*Math.random()),g.autoidprefix+i)),G("#"+F(this.id)).jqGrid("addRowData",i,n,g.droppos),n[f.p.localReader.id]=i;g.ondrop&&G.jgrid.isFunction(g.ondrop)&&g.ondrop.call(this,e,t,n)}}},g.drop_opts||{})},onstart:null,onstop:null,beforedrop:null,ondrop:null,drop_opts:{},drag_opts:{revert:"invalid",helper:"clone",cursor:"move",appendTo:"#jqgrid_dnd",zIndex:5e3},dragcopy:!1,dropbyname:!1,droppos:"first",autoid:!0,autoidprefix:"dnd_"},r||{})).connectWith)for(r.connectWith=r.connectWith.split(","),r.connectWith=G.map(r.connectWith,function(e){return G.jgrid.trim(e)}),G.data(f,"dnd",r),0===f.p.reccount||f.p.jqgdnd||i(),f.p.jqgdnd=!0,e=0;e<r.connectWith.length;e++)t=r.connectWith[e],G(t).droppable(G.jgrid.isFunction(r.drop)?r.drop.call(G(f),r):r.drop)}else i()}function i(){var e=G.data(f,"dnd");G("tr.jqgrow:not(.ui-draggable)",f).draggable(G.jgrid.isFunction(e.drag)?e.drag.call(G(f),e):e.drag)}})},gridResize:function(s){return this.each(function(){var i,r=this,o=r.grid,n=r.p,d=n.gView+">.ui-jqgrid-bdiv",a=!1,l=n.height;if(o&&G.fn.resizable){if((s=G.extend({},s||{})).alsoResize?(s._alsoResize_=s.alsoResize,delete s.alsoResize):s._alsoResize_=!1,s.stop&&G.jgrid.isFunction(s.stop)?(s._stop_=s.stop,delete s.stop):s._stop_=!1,s.stop=function(e,t){G(r).jqGrid("setGridWidth",t.size.width,s.shrinkToFit),G(n.gView+">.ui-jqgrid-titlebar").css("width",""),a?(G(i).each(function(){G(this).css("height","")}),"auto"!==l&&"100%"!==l||G(o.bDiv).css("height",l)):G(r).jqGrid("setGridParam",{height:G(d).height()}),r.fixScrollOffsetAndhBoxPadding&&r.fixScrollOffsetAndhBoxPadding(),s._stop_&&s._stop_.call(r,e,t)},i=d,"auto"!==l&&"100%"!==l||void 0!==s.handles||(s.handles="e,w"),s.handles){var e=G.map(String(s.handles).split(","),function(e){return G.jgrid.trim(e)});2===e.length&&("e"===e[0]&&"w"===e[1]||"e"===e[1]&&"w"===e[1])&&(i=n.gView+">div:not(.frozen-div)",a=!0,n.pager&&(i+=","+n.pager))}s._alsoResize_?s.alsoResize=i+","+s._alsoResize_:s.alsoResize=i,delete s._alsoResize_,G(n.gBox).resizable(s)}})}})});
//# sourceMappingURL=grid.jqueryui.js.map